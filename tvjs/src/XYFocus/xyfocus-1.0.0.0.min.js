(function(){"use strict";function e(e,t){for(var n=-1,o=Object.keys(t),r=o.length;++n<r;){var a=o[n];e[a]=t[a]}return e}function t(e){var t="_on"+e+"state";return{get:function(){var e=this[t];return e&&e.userHandler},set:function(n){var o=this[t];n?(o||(o={wrapper:function(e){return o.userHandler(e)},userHandler:n},Object.defineProperty(this,t,{value:o,enumerable:!1,writable:!0,configurable:!0}),this.addEventListener(e,o.wrapper,!1)),o.userHandler=n):o&&(this.removeEventListener(e,o.wrapper,!1),this[t]=null)},enumerable:!0}}function n(e,t,n){this.detail=t,this.target=n,this.timeStamp=Date.now(),this.type=e}function o(e,t){var n=i(e,t);return n?n.target:null}function r(e,t){var n=o(e,t);if(n){var r=document.activeElement;if(s(n,-1))return _.dispatchEvent(F.focusChanged,{previousFocusElement:r,keyCode:-1}),n}return null}function a(e,t,n,o){function r(e,t){var n=c();e===M.left||e===M.right?(n.top=Math.max(t.targetRect.top,t.referenceRect.top,x?x.top:Number.MIN_VALUE),n.bottom=Math.min(t.targetRect.bottom,t.referenceRect.bottom,x?x.bottom:Number.MAX_VALUE),n.bottom<=n.top&&(n.top=t.targetRect.top,n.bottom=t.targetRect.bottom),n.height=n.bottom-n.top,n.width=Number.MAX_VALUE,n.left=Number.MIN_VALUE,n.right=Number.MAX_VALUE):(n.left=Math.max(t.targetRect.left,t.referenceRect.left,x?x.left:Number.MIN_VALUE),n.right=Math.min(t.targetRect.right,t.referenceRect.right,x?x.right:Number.MAX_VALUE),n.right<=n.left&&(n.left=t.targetRect.left,n.right=t.targetRect.right),n.width=n.right-n.left,n.height=Number.MAX_VALUE,n.top=Number.MIN_VALUE,n.bottom=Number.MAX_VALUE),x=n}var a=document.activeElement;if(n||a!==A)x=null,A=null,N=null;else if(A&&N){var d=u(A.getBoundingClientRect());d.left===N.left&&d.top===N.top||(x=null,A=null,N=null)}var l=i(e,{focusRoot:b.focusRoot,historyRect:x,referenceElement:A,referenceRect:n});if(l&&s(l.target,t)){if(r(e,l),A=l.target,N=l.targetRect,l.target.classList.toggle(E.toggleModeActive,l.target.classList.contains(E.toggleMode)),"IFRAME"===l.target.nodeName){var f=l.target;if(G.isXYFocusEnabled(f)){var g=u({left:l.referenceRect.left-l.targetRect.left,top:l.referenceRect.top-l.targetRect.top,width:l.referenceRect.width,height:l.referenceRect.height}),m={};m[k.messageDataProperty]={type:k.dFocusEnter,direction:e,referenceRect:g},f.contentWindow.postMessage(m,"*")}}else if("function"==typeof l.target.navigateFocus){var g=u({left:l.referenceRect.left-l.targetRect.left,top:l.referenceRect.top-l.targetRect.top,width:l.referenceRect.width,height:l.referenceRect.height});l.target.navigateFocus(e,D.refRectToNavigateFocusRect(g))}return _.dispatchEvent(F.focusChanged,{previousFocusElement:a,keyCode:t}),!0}if(!o&&top!==window||"function"==typeof v.departFocus){var g=n;if(g||(g=document.activeElement?u(document.activeElement.getBoundingClientRect()):c()),top===window&&"function"==typeof v.departFocus)v.departFocus(e,D.refRectToNavigateFocusRect(g));else{var m={};m[k.messageDataProperty]={type:k.dFocusExit,direction:e,referenceRect:g}}return parent.postMessage(m,"*"),!0}return!1}function i(e,t){function n(e,t,n,o){if(e>=o||n>=t)return 0;var r=Math.min(t,o)-Math.max(e,n),a=Math.min(o-n,t-e);return 0===a?0:r/a}function o(e,t,o,r,a){var i,c,u=0,s=0,d=0;switch(e){case M.left:if(a.left>=r.left)break;i=n(r.top,r.bottom,a.top,a.bottom),c=r.left-a.right,i>0?d=n(o.top,o.bottom,a.top,a.bottom):s=r.bottom<=a.top?a.top-r.bottom:r.top-a.bottom;break;case M.right:if(a.right<=r.right)break;i=n(r.top,r.bottom,a.top,a.bottom),c=a.left-r.right,i>0?d=n(o.top,o.bottom,a.top,a.bottom):s=r.bottom<=a.top?a.top-r.bottom:r.top-a.bottom;break;case M.up:if(a.top>=r.top)break;i=n(r.left,r.right,a.left,a.right),c=r.top-a.bottom,i>0?d=n(o.left,o.right,a.left,a.right):s=r.right<=a.left?a.left-r.right:r.left-a.right;break;case M.down:if(a.bottom<=r.bottom)break;i=n(r.left,r.right,a.left,a.right),c=a.top-r.bottom,i>0?d=n(o.left,o.right,a.left,a.right):s=r.right<=a.left?a.left-r.right:r.left-a.right}return c>=0&&(c=t-c,s=t-s,c>=0&&s>=0&&(c+=c*i,u=c*L.primaryAxisDistanceWeight+s*L.secondaryAxisDistanceWeight+d*L.percentInHistoryShadowWeight)),u}function r(e,t){var n,o;return(!e&&!t||e&&!e.parentNode)&&document.activeElement!==document.body&&(e=document.activeElement),e?(n=e,o=u(n.getBoundingClientRect())):o=t?u(t):c(),{element:n,rect:o}}t=t||{},t.focusRoot=t.focusRoot||b.focusRoot||document.body,t.historyRect=t.historyRect||c();var a=Math.max(v.screen.availHeight,v.screen.availWidth),i=r(t.referenceElement,t.referenceRect);if(i.element){var s=i.element.dataset.xyfocus;if(s){var l=JSON.parse(s.replace(/\w+(?=:)/g,'"$&"').replace(/'/g,'"')),g=l[e]||l[e[0].toUpperCase()+e.slice(1)];if(g){for(var m,p=i.element;!m&&p;)m=p.querySelector(g),p=p.parentElement;if(m)return m===document.activeElement?null:{target:m,targetRect:u(m.getBoundingClientRect()),referenceRect:i.rect,usedOverride:!0}}}}for(var h={element:null,rect:null,score:0},y=t.focusRoot.getElementsByTagName("*"),R=0,w=y.length;w>R;R++){var E=y[R];if(i.element!==E&&d(E)&&!f(E)){var k=u(E.getBoundingClientRect());if(0!==k.width&&0!==k.height){var F=o(e,a,t.historyRect,i.rect,k);F>h.score&&(h.element=E,h.rect=k,h.score=F)}}}return h.element?{target:h.element,targetRect:h.rect,referenceRect:i.rect,usedOverride:!1}:null}function c(){return{top:-1,bottom:-1,right:-1,left:-1,height:0,width:0}}function u(e){return{top:Math.floor(e.top),bottom:Math.floor(e.top+e.height),right:Math.floor(e.left+e.width),left:Math.floor(e.left),height:Math.floor(e.height),width:Math.floor(e.width)}}function s(e,t){var n=_.dispatchEvent(F.focusChanging,{nextFocusElement:e,keyCode:t});return n||e.focus(),document.activeElement===e}function d(e){var t=e.nodeName;if(!e.hasAttribute("tabindex")&&-1===C.indexOf(t)&&!e.classList.contains(E.focusable))return!1;if("IFRAME"===t&&!G.isXYFocusEnabled(e))return!1;if("DIV"===t&&e.winControl&&e.winControl.disabled)return!1;var n=getComputedStyle(e,null);return"-1"!==e.getAttribute("tabIndex")&&"none"!==n.display&&"hidden"!==n.visibility&&!e.disabled}function l(e){for(var t=e.parentElement;t&&!g(t);)t=t.parentElement;return t}function f(e){var t=l(e);return t&&!t.classList.contains(E.toggleModeActive)}function g(e){if(e.classList.contains(E.toggleMode))return!0;if("INPUT"===e.nodeName){if(P[e.type.toLowerCase()])return!0}else if("TEXTAREA"===e.nodeName)return!0;return!1}function m(e){var t=!1,n=!1,o=!1;e&&(t=e[y]("."+E.suspended+", ."+E.suspended+" *"),n=g(e),o=e.classList.contains(E.toggleModeActive));var r=T.RestState;return t?r=T.SuspendedState:n&&(r=o?T.ToggleModeActiveState:T.ToggleModeRestState),r}function p(e){if(!e.defaultPrevented){var t=m(document.activeElement),n="";if(-1!==b.keyCodeMap.up.indexOf(e.keyCode)?n="up":-1!==b.keyCodeMap.down.indexOf(e.keyCode)?n="down":-1!==b.keyCodeMap.left.indexOf(e.keyCode)?n="left":-1!==b.keyCodeMap.right.indexOf(e.keyCode)&&(n="right"),n){var o=t.xyfocus(n,e.keyCode);o&&e.preventDefault()}}}function h(e){if(!e.defaultPrevented){var t=document.activeElement,n=!1,o=m(t);-1!==b.keyCodeMap.accept.indexOf(e.keyCode)?n=o.accept(t):-1!==b.keyCodeMap.cancel.indexOf(e.keyCode)&&(n=o.cancel(t)),n&&e.preventDefault()}}var v=this,b={},y="msMatchesSelector"in document.documentElement?"msMatchesSelector":"webkitMatchesSelector"in document.documentElement?"webkitMatchesSelector":"matches"in document.documentElement?"matches":"",R={F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,num0:48,num1:49,num2:50,num3:51,num4:52,num5:53,num6:54,num7:55,num8:56,num9:57,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,numLock:144,scrollLock:145,browserBack:166,browserForward:167,semicolon:186,equal:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBracket:221,singleQuote:222,IME:229,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,deleteKey:46,leftWindows:91,rightWindows:92,menu:93,NavigationView:136,NavigationMenu:137,NavigationUp:138,NavigationDown:139,NavigationLeft:140,NavigationRight:141,NavigationAccept:142,NavigationCancel:143,GamepadA:195,GamepadB:196,GamepadX:197,GamepadY:198,GamepadRightShoulder:199,GamepadLeftShoulder:200,GamepadLeftTrigger:201,GamepadRightTrigger:202,GamepadDPadUp:203,GamepadDPadDown:204,GamepadDPadLeft:205,GamepadDPadRight:206,GamepadMenu:207,GamepadView:208,GamepadLeftThumbstick:209,GamepadRightThumbstick:210,GamepadLeftThumbstickUp:211,GamepadLeftThumbstickDown:212,GamepadLeftThumbstickRight:213,GamepadLeftThumbstickLeft:214,GamepadRightThumbstickUp:215,GamepadRightThumbstickDown:216,GamepadRightThumbstickRight:217,GamepadRightThumbstickLeft:218};n.prototype={constructor:n,bubbles:{value:!1,writable:!1},cancelable:{value:!1,writable:!1},currentTarget:{get:function(){return this.target}},defaultPrevented:{get:function(){return this._preventDefaultCalled}},trusted:{value:!1,writable:!1},eventPhase:{value:0,writable:!1},target:null,timeStamp:null,type:null,preventDefault:function(){this._preventDefaultCalled=!0},stopImmediatePropagation:function(){this._stopImmediatePropagationCalled=!0},stopPropagation:function(){}},n.supportedForProcessing=!1;var w={_listeners:null,addEventListener:function(e,t,n){n=n||!1,this._listeners=this._listeners||{};for(var o=this._listeners[e]=this._listeners[e]||[],r=0,a=o.length;a>r;r++){var i=o[r];if(i.useCapture===n&&i.listener===t)return}o.push({listener:t,useCapture:n})},dispatchEvent:function(e,t){var o=this._listeners&&this._listeners[e];if(o){var r=new n(e,t,this);o=o.slice(0,o.length);for(var a=0,i=o.length;i>a&&!r._stopImmediatePropagationCalled;a++)o[a].listener(r);return r.defaultPrevented||!1}return!1},removeEventListener:function(e,t,n){n=n||!1;var o=this._listeners&&this._listeners[e];if(o)for(var r=0,a=o.length;a>r;r++){var i=o[r];if(i.listener===t&&i.useCapture===n){o.splice(r,1),0===o.length&&delete this._listeners[e];break}}}},E={focusable:"win-focusable",suspended:"win-xyfocus-suspended",toggleMode:"win-xyfocus-togglemode",toggleModeActive:"win-xyfocus-togglemode-active"},k={messageDataProperty:"xyfocusControlMessage",register:"register",unregister:"unregister",dFocusEnter:"dFocusEnter",dFocusExit:"dFocusExit"},M={left:"left",right:"right",up:"up",down:"down"},F={focusChanging:"focuschanging",focusChanged:"focuschanged"},C=["A","BUTTON","IFRAME","INPUT","SELECT","TEXTAREA","X-MS-WEBVIEW"],L={primaryAxisDistanceWeight:30,secondaryAxisDistanceWeight:20,percentInHistoryShadowWeight:1e5};b.keyCodeMap={left:[],right:[],up:[],down:[],accept:[],cancel:[]},b.findNextFocusElement=o,b.moveFocus=r;var A,N,x,P={date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},T={};!function(e){function t(e){return e&&e.click&&e.click(),!1}function n(){return!1}function o(){}function r(){}function i(){}function c(){}o.accept=t,o.cancel=n,o.xyfocus=a,e.RestState=o,r.accept=n,r.cancel=n,r.xyfocus=n,e.SuspendedState=r,i.accept=function(e){return e.classList.add(E.toggleModeActive),!0},i.cancel=n,i.xyfocus=a,e.ToggleModeRestState=i,c.cancel=function(e){return e&&e.classList.remove(E.toggleModeActive),!0},c.accept=t,c.xyfocus=n,e.ToggleModeActiveState=c}(T);var D={};!function(e){function t(e){var t=document.createElement("div");t.style.position="fixed",t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",document.body.appendChild(t);var n=t.getBoundingClientRect();return document.body.removeChild(t),n}function n(e){return u({left:e.left,top:e.top,width:e.right-e.left,height:e.bottom-e.top})}e.refRectToNavigateFocusRect=t,e.navigateFocusRectToRefRect=n}(D);var G={};if(function(e){function t(){return i(function(){return!1}),c.length}function n(e){var t=document.getElementsByTagName("IFRAME"),n=Array.prototype.filter.call(t,function(t){return t.contentWindow===e});return n.length?n[0]:null}function o(e){var t=!1;return i(function(n){n===e&&(t=!0)}),t}function r(e){c.push(e)}function a(e){var t=-1;i(function(n,o){n===e&&(t=o)}),-1!==t&&c.splice(t,1)}function i(e){for(var t=c.length-1;t>=0;t--)try{var n=c[t];n.contentWindow?e(n,t):c.splice(t,1)}catch(o){c.splice(t,1)}}var c=[];e.count=t,e.getIFrameFromWindow=n,e.isXYFocusEnabled=o,e.registerIFrame=r,e.unregisterIFrame=a}(G),v.document){b.keyCodeMap.left.push(R.GamepadLeftThumbstickLeft,R.GamepadDPadLeft,R.NavigationLeft),b.keyCodeMap.right.push(R.GamepadLeftThumbstickRight,R.GamepadDPadRight,R.NavigationRight),b.keyCodeMap.up.push(R.GamepadLeftThumbstickUp,R.GamepadDPadUp,R.NavigationUp),b.keyCodeMap.down.push(R.GamepadLeftThumbstickDown,R.GamepadDPadDown,R.NavigationDown),b.keyCodeMap.accept.push(R.GamepadA,R.NavigationAccept),b.keyCodeMap.cancel.push(R.GamepadB,R.NavigationCancel),v.addEventListener("message",function(e){var t=null;try{if(t=e.source,!t)return}catch(e){return}if(e.data&&e.data[k.messageDataProperty]){var n=e.data[k.messageDataProperty];switch(n.type){case k.register:var o=G.getIFrameFromWindow(t);o&&G.registerIFrame(o);break;case k.unregister:var o=G.getIFrameFromWindow(t);o&&G.unregisterIFrame(o);break;case k.dFocusEnter:var r=a(n.direction,-1,n.referenceRect,!0);r||(d(document.body)?document.body.focus():a(n.direction,-1));break;case k.dFocusExit:var o=G.getIFrameFromWindow(t);if(document.activeElement!==o)break;var i=n.referenceRect,c=o.getBoundingClientRect();i.left+=c.left,i.top+=c.top,"number"==typeof i.right&&(i.right+=c.left),"number"==typeof i.bottom&&(i.bottom+=c.top),a(n.direction,-1,i)}}}),document.addEventListener("departingfocus",function(e){var t=a(e.navigationReason,-1,D.navigateFocusRectToRefRect(e.origin));t&&e&&"function"==typeof e.focus&&e.focus()}),document.addEventListener("navigatingfocus",function(e){var t=a(e.navigationReason,-1,D.navigateFocusRectToRefRect(e.origin));t&&e&&"function"==typeof e.focus&&e.focus()}),document.addEventListener("DOMContentLoaded",function(){if(document.addEventListener("keydown",h,!0),document.addEventListener("keydown",p),v.top!==v.window){var e={};e[k.messageDataProperty]={type:k.register,version:1},parent.postMessage(e,"*")}});var I={focusRoot:{get:function(){return b.focusRoot},set:function(e){b.focusRoot=e}},findNextFocusElement:o,keyCodeMap:b.keyCodeMap,moveFocus:r,onfocuschanged:t(F.focusChanged),onfocuschanging:t(F.focusChanging),_xyfocus:a,_iframeHelper:G};e(I,w),I._listeners={},I.Key=R;var _=I;v.xyfocus=I}v.navigator&&"string"==typeof v.navigator.gamepadInputEmulation&&(v.navigator.gamepadInputEmulation="keyboard")}).call(this);